# NAVI RAG Search Agent ğŸ§­  
í•œêµ­ì¸í„°ë„·ì§„í¥ì›(KISA) ê·œì • ë¬¸ì„œ ê¸°ë°˜ ì‚¬ë‚´ ì—…ë¬´ ì§€ì› RAG ì±—ë´‡

> ëŒ€ê·œëª¨ ê·œì •Â·ì§€ì¹¨Â·ê·œì¹™ PDFë¥¼ ë²¡í„°í™”í•˜ê³ ,  
> ì‚¬ë‚´ ì§ì›ì˜ ì§ˆì˜ë¥¼ RAG íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì²˜ë¦¬í•´  
> **ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš© ê°€ëŠ¥í•œ ë‹µë³€**ì„ ì œê³µí•˜ëŠ” ë¬¸ì„œ ê¸°ë°˜ AI ê²€ìƒ‰ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

í•œêµ­ì¸í„°ë„·ì§„í¥ì›(KISA)ì˜ ì •ê´€, ê·œì •, ê·œì¹™, ì§€ì¹¨, ì„œì‹ë¥˜ ë“± ìˆ˜ë°± ê°œì˜ PDF ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ:

- â€œì–´ë–¤ ê·œì •ì˜ ëª‡ ì¡°ì— ì´ëŸ° ë‚´ìš©ì´ ìˆë‚˜ìš”?â€
- â€œì¶œì¥ë¹„ ê´€ë ¨ ì–‘ì‹ì„ ì•Œë ¤ì¤˜.â€
- â€œì•ˆì „ë³´ê±´ê´€ë¦¬ê·œì •ì—ì„œ ì‘ì—…ì¤‘ì§€ ê´€ë ¨ ì¡°í•­ ì°¾ì•„ì¤˜.â€

ì™€ ê°™ì€ ì‹¤ë¬´ ì¤‘ì‹¬ ì§ˆë¬¸ì— ëŒ€í•´,

> **LLM + RAG íŒŒì´í”„ë¼ì¸ + Qdrant ë²¡í„° DB**ë¥¼ í†µí•´  
> ê´€ë ¨ ì¡°í•­ê³¼ ì¶œì²˜ ë¬¸ì„œë¥¼ í•¨ê»˜ ë°˜í™˜í•©ë‹ˆë‹¤.

ì´ ë ˆí¬ëŠ” SKN13-FINAL-6Team í”„ë¡œì íŠ¸ ì¤‘  
**ë¬¸ì„œ ê²€ìƒ‰ / RAG ì—ì´ì „íŠ¸ ê¸°ëŠ¥ë§Œ ëª¨ì•„ ë¦¬íŒ©í† ë§í•œ ë…ë¦½ ë²„ì „**ì…ë‹ˆë‹¤.

---

## 2. ì£¼ìš” ê¸°ëŠ¥

### ğŸ” ê·œì • ë¬¸ì„œ RAG ê²€ìƒ‰

- `documents_kisa_pdf` í•˜ìœ„ PDF ì „ì²´ ë²¡í„°í™”
- íŒŒì¼ëª… ê·œì¹™ì„ ê¸°ë°˜ìœ¼ë¡œ ë¬¸ì„œ ìœ í˜•, ë„ë©”ì¸ ìë™ ì¶”ì¶œ  
  ì˜ˆ: `2_05_ì¸ì‚¬ê·œì •(240221).pdf`  
  - `2` â†’ ê·œì •  
  - `05` â†’ ì¸ì‚¬ ë„ë©”ì¸
- ìì—°ì–´ ì§ˆë¬¸ â†’ ë²¡í„° ê²€ìƒ‰ â†’ ì¬ë­í‚¹ â†’ LLM ìµœì¢… ì‘ë‹µ
- **ì¶œì²˜ ë¬¸ì„œ/í˜ì´ì§€ ì •ë³´ í¬í•¨**

### ğŸ§¾ ì„œì‹/ì–‘ì‹(Form) íŠ¹í™” ê²€ìƒ‰

- `documents_kisa_pdf/forms_extracted_v6` í´ë”ì˜ ì‹ ì²­ì„œÂ·í™•ì¸ì„œ ë“± ì–‘ì‹ ë¬¸ì„œ ë³„ë„ ì¸ë±ì‹±
- ì–‘ì‹(Form) ê´€ë ¨ ì§ˆì˜ëŠ” ì¼ë°˜ ê·œì •ì´ ì•„ë‹Œ  
  **form ì „ìš© ì»¬ë ‰ì…˜ë§Œ íƒ€ê²ŸíŒ…**
- `analyze_form_patterns.py` ê¸°ë°˜ form íŒ¨í„´ ë¶„ì„ ë° ë§¤ì¹­

### ğŸ§  RAG íŒŒì´í”„ë¼ì¸ êµ¬ì„± ìš”ì†Œ

#### `rag_indexer.py`
- PDF â†’ í…ìŠ¤íŠ¸ â†’ ì²­í¬ ë¶„í•   
- ë©”íƒ€ë°ì´í„°(ë¬¸ì„œìœ í˜•/ë„ë©”ì¸/í˜ì´ì§€ ë“±) ë¶€ì°©  
- Qdrant ì»¬ë ‰ì…˜ ì—…ë¡œë“œ  

#### `rag_search.py`
- ì‚¬ìš©ì ì§ˆë¬¸ ë²¡í„°í™”  
- Qdrantì—ì„œ Top-k ê²€ìƒ‰  
- form ê´€ë ¨ ì—¬ë¶€ì— ë”°ë¼ **ë‘ ì»¬ë ‰ì…˜ ë¶„ê¸° ì²˜ë¦¬**  

#### `pipeline.py`
- ê²€ìƒ‰ ë¬¸ì„œë¥¼ LLM ì»¨í…ìŠ¤íŠ¸ë¡œ ì¡°í•©  
- `system_prompt.md`, `user_prompt.md` ë¡œë“œ  
- ìµœì¢… ë‹µë³€ + ì¶œì²˜ êµ¬ì¡°í™”  

#### `answerer.py`
- LLM í˜¸ì¶œ ë˜í•‘  
- ë§ˆí¬ë‹¤ìš´ í¬ë§·íŒ…, ë¬¸ì¥ ë‹¤ë“¬ê¸°, ê°•ì¡° ì²˜ë¦¬  

#### ê¸°íƒ€ êµ¬ì„±
- `constants.py`: ì»¬ë ‰ì…˜/ë©”íƒ€ë°ì´í„° í‚¤ ìƒìˆ˜  
- `filters.py`: ë¬¸ì„œ ìœ í˜•Â·ë„ë©”ì¸ ê¸°ë°˜ í•„í„°ë§  
- `keyword_extractor.py`: í‚¤ì›Œë“œ ë¶„ì„í•´ ë¼ìš°íŒ… íŒë‹¨  
- `test_enhanced_rag.py`: ê²€ìƒ‰ í’ˆì§ˆ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

---

## 3. ê¸°ìˆ  ìŠ¤íƒ

### Backend
- Python 3.12
- Django REST Framework  
- Qdrant Vector DB  

### AI / RAG
- OpenAI GPT ê³„ì—´ (GPT-4o-mini ë“±)  
- Embedding: `text-embedding-3-large`  
- Custom RAG Pipeline ì „ë©´ ì»¤ìŠ¤í…€ êµ¬í˜„

### Infra
- Docker, Docker Compose, Nginx  
- FrontendëŠ” ë³„ë„ ë ˆí¬(ì˜ˆ: Vercel)ì—ì„œ React + Vite + Tailwind í™œìš© ê°€ëŠ¥

---

## 4. í´ë” êµ¬ì¡°

```bash
NAVI-RAG-SEARCH-AGENT/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ chatbot/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ answerer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ api.py
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.py
â”‚   â”‚   â”‚   â”œâ”€â”€ filters.py
â”‚   â”‚   â”‚   â”œâ”€â”€ keyword_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ pipeline.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_indexer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_search.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_service.py
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ qdrant/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ admin.py
â”‚   â”‚   â”œâ”€â”€ apps.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ services.py
â”‚   â”‚   â”œâ”€â”€ tests.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ views.py
â”‚   â”‚
â”‚   â”œâ”€â”€ analyze_form_patterns.py
â”‚   â”œâ”€â”€ embed_documents.py
â”‚   â””â”€â”€ test_enhanced_rag.py
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ system_prompt.md
â”‚   â””â”€â”€ user_prompt.md
â”‚
â”œâ”€â”€ documents_kisa_pdf/
â”‚   â”œâ”€â”€ forms_extracted_v6/
â”‚   â”œâ”€â”€ 1_01_í•œêµ­ì¸í„°ë„·ì§„í¥ì› ì •ê´€(240715).pdf
â”‚   â”œâ”€â”€ 2_05_ì¸ì‚¬ê·œì •(240221).pdf
â”‚   â”œâ”€â”€ 3_05_ì¸ì‚¬ê´€ë¦¬ê·œì¹™(230706).pdf
â”‚   â””â”€â”€ 4_03_êµìœ¡í›ˆë ¨ì§€ì¹¨(240201).pdf
â”‚
â””â”€â”€ README.md
```

## 5. ë¡œì»¬ í™˜ê²½ì—ì„œ RAG í…ŒìŠ¤íŠ¸ ë°©ë²•

ë¡œì»¬ì—ì„œ **Qdrant + Django RAG íŒŒì´í”„ë¼ì¸**ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ìµœì†Œ ì‹¤í–‰ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

### 5-1. Qdrant ì‹¤í–‰ (Docker ì‚¬ìš©)
```bash
docker run -p 6333:6333 -p 6334:6334 \
    -v qdrant_storage:/qdrant/storage \
    qdrant/qdrant
```
ì •ìƒ ì‹¤í–‰ë˜ë©´ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### 5-1-1. ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ìš©(ë°ëª¨ë²„ì „)
```bash
docker run -p 6333:6333 qdrant/qdrant
```
ì‹¤í–‰ì€ ë˜ì–´ì„œ dashboardëŠ” ì¼œì§€ì§€ë§Œ, ì¬ì‹œì‘ì‹œ ë²¡í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.


### 5-2. ë¬¸ì„œ ì„ë² ë”© (ê·œì •/ì§€ì¹¨/ì–‘ì‹ PDF ì—…ë¡œë“œ)
```bash
python backend/embed_documents.py
```

ì‹¤í–‰ ê²°ê³¼:

- ëª¨ë“  PDFê°€ í…ìŠ¤íŠ¸ ì¶”ì¶œ â†’ ì²­í¬í™” â†’ ì„ë² ë”© ìƒì„± â†’ Qdrantì— ì—…ë¡œë“œ
- ê·œì •/ê·œì¹™/ì§€ì¹¨ ë¬¸ì„œëŠ” ê·œì • ì»¬ë ‰ì…˜
- ì–‘ì‹ë¥˜(form) ë¬¸ì„œëŠ” form ì»¬ë ‰ì…˜ìœ¼ë¡œ ìë™ ë¶„ë¥˜

## 6. Django ê¸°ë°˜ RAG ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
### 6-1. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```python 
python backend/test_enhanced_rag.py
```

ì˜ˆì‹œ ì¶œë ¥ (ìƒ˜í”Œ):

```bash
[QUESTION] ì¶œì¥ë¹„ ê´€ë ¨ ì–‘ì‹ ë­ ì¨ì•¼ í•´?
[TOP_K RESULTS] 5ê°œ ë¬¸ì„œ ë§¤ì¹­ë¨
[FORM DETECTED] form ì»¬ë ‰ì…˜ì—ì„œ ê²€ìƒ‰
[FINAL ANSWER]
- ì œì¶œ ì„œë¥˜: ì¶œì¥ì‹ ì²­ì„œ, ì¶œì¥ë³µëª…ì„œ
- ì„œì‹ ìœ„ì¹˜: forms_extracted_v6/â€¦
- ê´€ë ¨ ê·œì •: ì¸ì‚¬ê´€ë¦¬ê·œì¹™ ì œâ—‹ì¡°
```

## 7. í”„ë¡ íŠ¸ì—”ë“œ (Vercel ë°°í¬)ì™€ API ì—°ë™

í”„ë¡ íŠ¸ì—”ë“œëŠ” React + Vite + Tailwind ê¸°ë°˜.
API ì—”ë“œí¬ì¸íŠ¸ëŠ” Django REST ê¸°ì¤€:

```bash
POST /api/chat/query/
``` 

ìš”ì²­ ì˜ˆì‹œ:

```bash
{
  "query": "ì¶œì¥ë¹„ ì‹ ì²­ì€ ì–´ë–¤ ì„œë¥˜ê°€ í•„ìš”í•´?"
}
```

ì‘ë‹µ ì˜ˆì‹œ:
```bash
{
  "answer": "ì¶œì¥ë¹„ ì‹ ì²­ì—ëŠ” ì¶œì¥ì‹ ì²­ì„œì™€ ì¶œì¥ë³µëª…ì„œê°€ í•„ìš”í•©ë‹ˆë‹¤.",
  "sources": [
    {
      "document": "ì¸ì‚¬ê´€ë¦¬ê·œì¹™",
      "page": 12
    }
  ]
}
```

Vercel í”„ë¡ íŠ¸ ì½”ë“œ ì˜ˆì‹œ:
```bash
const res = await fetch(`${API_URL}/api/chat/query/`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ query }),
});
```

## 8. ì‹¤í–‰ ìˆœì„œ ìš”ì•½
1) Qdrant ì‹¤í–‰
```bash 
docker run -p 6333:6333 qdrant/qdrant
```
2) ë¬¸ì„œ ì„ë² ë”©
```bash 
python backend/embed_documents.py
```
3) Django ì„œë²„ ì‹¤í–‰
```python
python manage.py runserver
```